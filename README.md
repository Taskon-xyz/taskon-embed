# TaskOn Embed SDK

A TypeScript SDK for embedding TaskOn widgets into your website with iframe integration and seamless authentication.

## Features

- 🎯 **Easy Integration**: Simple iframe-based embedding
- 🔐 **Multiple Auth Methods**: Support for email and EVM wallet authentication
- 🔧 **TypeScript**: Full type safety and IntelliSense support
- ⚡ **Lightweight**: Minimal bundle size with tree-shaking support
- 🔄 **Event-driven**: Built-in EventEmitter for handling iframe communication

## Installation

```bash
npm install @taskon/embed
```

## Quick Start

### Basic Setup

```typescript
import { TaskOnEmbed } from "@taskon/embed";

// Initialize the embed widget
const embed = new TaskOnEmbed({
  clientId: "your-client-id",
  baseUrl: "https://taskon.xyz", // or your white-label domain
  containerElement: "#taskon-container", // CSS selector or HTMLElement
  width: "100%", // optional
  height: 600, // optional
});

// Initialize the iframe
await embed.init();

// Set up event listeners
embed.on("loginRequired", ({ type }) => {
  console.log("Login required for type:", type);
});

embed.on("taskCompleted", (task, taskOnUserId) => {
  console.log("Task completed:", task, "by user:", taskOnUserId);
});
```

### Email Authentication

```typescript
// Check if user is already logged in
const isLoggedIn = await embed.getIsLoggedIn("email", "user@example.com");

if (!isLoggedIn) {
  // Login with email (signature required for new sessions)
  await embed.login({
    type: "email",
    value: "user@example.com",
    signature: serverSignature, // generated by your backend
  });
} else {
  // User is already logged in, signature is optional
  await embed.login({
    type: "email",
    value: "user@example.com",
  });
}
```

### EVM Wallet Authentication

```typescript
async function connectWallet() {
  if (typeof window.ethereum !== "undefined") {
    try {
      // Request account access
      const accounts = await window.ethereum.request({
        method: "eth_requestAccounts",
      });
      const address = accounts[0];

      // Check if already logged in
      const isLoggedIn = await embed.getIsLoggedIn("evm", address);

      if (!isLoggedIn) {
        // Generate signature using your backend
        const signature = await generateServerSignature(address);

        // Login with wallet credentials
        await embed.login({
          type: "evm",
          value: address,
          signature,
        });
      } else {
        // Already logged in
        await embed.login({
          type: "evm",
          value: address,
        });
      }

      console.log("Wallet login successful!");
    } catch (error) {
      console.error("Wallet connection failed:", error);
    }
  }
}

// Helper function to generate server signature
async function generateServerSignature(value: string): Promise<string> {
  // Call your backend API to generate signature
  const response = await fetch("/api/auth/sign", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ value }),
  });
  const { signature } = await response.json();
  return signature;
}
```

## API Reference

### TaskOnEmbed

Main class for embedding TaskOn widgets.

#### Constructor

```typescript
new TaskOnEmbed(config: TaskOnEmbedConfig)
```

#### Configuration Options

```typescript
interface TaskOnEmbedConfig {
  clientId: string; // Your TaskOn client ID (required)
  baseUrl: string; // TaskOn service URL (required)
  containerElement: string | HTMLElement; // Container for the iframe (required)
  width?: string | number; // Width of the iframe (optional)
  height?: string | number; // Height of the iframe (optional)
}
```

#### Methods

```typescript
// Initialization
init(): Promise<void> // Initialize the iframe

// Authentication
login(request: LoginRequest): Promise<void> // Login with email or EVM wallet
logout(): Promise<void> // Logout from the iframe
getIsLoggedIn(loginType: LoginType, value: string): Promise<boolean> // Check login status

// UI Management
updateSize(width?: string | number, height?: string | number): void // Update iframe size
destroy(): void // Destroy the instance and clean up resources
```

#### Event Handling

The SDK extends EventEmitter and supports these events:

```typescript
// Login required event
embed.on("loginRequired", (data: { type?: LoginType }) => {
  console.log("Login required:", data.type);
});

// Task completed event
embed.on("taskCompleted", (task: any, taskOnUserId: number) => {
  console.log("Task completed:", task, "by user:", taskOnUserId);
});
```

#### Types

```typescript
type LoginType = "email" | "evm";

interface LoginRequest {
  type: LoginType;
  value: string; // Email address or EVM address
  signature?: string; // Optional when user is already logged in
}

interface AuthUser {
  id: string;
  type: LoginType;
  value: string;
  signature?: string;
  timestamp?: number;
}
```

## TypeScript Support

The SDK is written in TypeScript and provides full type definitions:

```typescript
import type {
  TaskOnEmbedConfig,
  LoginRequest,
  LoginType,
  AuthUser,
  TaskOnEmbedEvents,
} from "@taskon/embed";
```

## Browser Support

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## License

MIT License

## Support

For questions and support, please contact [support@taskon.xyz](mailto:support@taskon.xyz)
