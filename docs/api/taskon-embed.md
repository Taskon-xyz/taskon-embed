# TaskOnEmbed Class

`TaskOnEmbed` is the core class of the SDK used to embed TaskOn into third-party sites and communicate with the iframe via a message bridge.

## Constructor

```typescript
new TaskOnEmbed(config: TaskOnEmbedConfig)
```

### Parameters

- `config: TaskOnEmbedConfig` - configuration object

### Example

```typescript
import { TaskOnEmbed } from "@taskon/embed";

const embed = new TaskOnEmbed({
  clientId: "your-client-id",
  baseUrl: "https://taskon.xyz", // or your white-label domain
  containerElement: "#taskon-container",
  width: "100%",
  height: 600,
});

// Initialize the iframe
await embed.init();
```

## Methods

### init()

Initialize the embed iframe and establish communication.

```typescript
init(): Promise<void>
```

#### Example

```typescript
await embed.init();
```

### login()

Request login inside the iframe. Supports both Email and EVM wallet.

```typescript
login(request: LoginRequest): Promise<void>
```

#### Parameters

- `request: LoginRequest`

#### Email login example

```typescript
await embed.login({
  type: "email",
  value: "user@example.com",
  signature: serverSignature, // generated by your backend
});
```

#### EVM wallet login example

```typescript
await embed.login({
  type: "evm",
  value: "0x1234...",
  signature: serverSignature, // backend signature over value
});
```

> Tip: When `embed.getIsLoggedIn()` returns true, you can omit `signature`.

### logout()

Request logout inside the iframe.

```typescript
logout(): Promise<void>
```

#### Example

```typescript
await embed.logout();
```

### getIsLoggedIn()

Check if the user is logged in by iframe. If true, no need to set signature in login request.

```typescript
getIsLoggedIn(loginType: LoginType, value: string): Promise<boolean>
```

#### Parameters

- `loginType: LoginType` - "email" or "evm"
- `value: string` - The credential value (email or EVM address)

#### Example

```typescript
const isLoggedIn = await embed.getIsLoggedIn("email", "user@example.com");
if (isLoggedIn) {
  console.log("Already logged in");
}
```

### updateSize()

Update iframe size.

```typescript
updateSize(width?: string | number, height?: string | number): void
```

#### Example

```typescript
embed.updateSize("100%", 720);
```

### destroy()

Destroy the instance and release resources.

```typescript
destroy(): void
```

#### Example

```typescript
embed.destroy();
```

## Events

Register events via `embed.on(event, handler)`.

- `loginRequired`: `(data: { type?: LoginType }) => void` - Fired when iframe requests user login
- `taskCompleted`: `(task: any, taskOnUserId: number) => void` - Fired when a task is completed

```typescript
embed.on("loginRequired", ({ type }) => {
  console.log("Login required for type:", type);
  // Handle login request
});

embed.on("taskCompleted", (task, taskOnUserId) => {
  console.log("Task completed:", task, "by user:", taskOnUserId);
  // Handle task completion
});
```

## Complete Example

```typescript
import { TaskOnEmbed } from "@taskon/embed";

const embed = new TaskOnEmbed({
  clientId: "your-client-id",
  baseUrl: "https://taskon.xyz",
  containerElement: "#taskon-container",
});

// Initialize the embed
await embed.init();

// Set up event listeners
embed.on("loginRequired", async ({ type }) => {
  if (type === "email") {
    // Handle email login
    const email = "user@example.com";
    const isLoggedIn = await embed.getIsLoggedIn("email", email);

    if (!isLoggedIn) {
      const signature = await fetch("/api/auth/sign", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ value: email }),
      }).then(r => r.text());

      await embed.login({
        type: "email",
        value: email,
        signature,
      });
    } else {
      await embed.login({
        type: "email",
        value: email,
      });
    }
  }
});

embed.on("taskCompleted", (task, taskOnUserId) => {
  console.log("Task completed:", task, "by user:", taskOnUserId);
});
```
